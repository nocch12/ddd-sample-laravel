# クーポン
coupons:
  columns:
    id: string # クーポンコード
    name: string # 名前
    company_id: string # 企画加盟企業コード
    distributionLimit: unsignedInteger # 配布上限数
    distribution_begin: dateTime # 配布開始日
    distribution_end: dateTime # 配布終了日
    use_begin: dateTime # 利用開始日
    use_end: dateTime # 利用終了日
    point_rate: # ポイント付与率
      type: double
      args: 
        - 4
        - 1
    timestamps:
  indexes:
    - columns: [id]
      type: primary
  foreign_keys:
    - columns: [company_id]
      references: [id]
      table: companies
# クーポン設定対象店舗
coupon_shops:
  columns:
    coupon_id: string # クーポンコード
    shop_id: unsignedBigInteger # 店舗
    timestamps:
  indexes:
    - columns: [coupon_id, shop_id]
      type: unique
  foreign_keys:
    - columns: [coupon_id]
      references: [id]
      table: coupons
    - columns: [shop_id]
      references: [id]
      table: shops
# クーポン設定対象商品
coupon_items:
  columns:
    coupon_id: string # クーポンコード
    company_item_id: unsignedBigInteger # 商品
    timestamps:
  indexes:
    - columns: [coupon_id, company_item_id]
      type: unique
  foreign_keys:
    - columns: [coupon_id]
      references: [id]
      table: coupons
    - columns: [company_item_id]
      references: [id]
      table: payments
# クーポン配布
coupon_distributions:
  columns:
    coupon_id: string # クーポンコード
    user_id: unsignedBigInteger # 会員コード
    distribution_status: # 配布状況フラグ
      type: unsignedTinyInteger
      default: 0
    distributed_at: dateTime # 配布日時
    timestamps:
  indexes:
    - columns: [coupon_id, user_id]
      type: unique
  foreign_keys:
    - columns: [coupon_id]
      references: [id]
      table: coupons
    - columns: [user_id]
      references: [id]
      table: users
# クーポン利用
coupon_uses:
  columns:
    payment_id: unsignedBigInteger # レシート番号
    coupon_id: string # クーポンコード
    timestamps:
  indexes:
    - columns: [payment_id, coupon_id]
      type: unique
  foreign_keys:
    - columns: [payment_id]
      references: [id]
      table: payments
    - columns: [coupon_id]
      references: [id]
      table: coupons
